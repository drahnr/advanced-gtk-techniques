<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Setting up Gettext</title>
<link rel="stylesheet" type="text/css" href="C.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="yelp.js"></script><link xmlns:m="http://www.w3.org/1998/Math/MathML" rel="stylesheet" href="../index.css" type="text/css">
<script xmlns:m="http://www.w3.org/1998/Math/MathML" src="../highlight.pack.js"></script><script xmlns:m="http://www.w3.org/1998/Math/MathML">
$(document).ready(function() {
  $('div.code pre').each(function(i, e) {hljs.highlightBlock(e, '    ')});
});
    </script><link xmlns:m="http://www.w3.org/1998/Math/MathML" rel="stylesheet" href="http://yandex.st/highlightjs/6.1/styles/github.min.css">
</head>
<body>
<div xmlns:m="http://www.w3.org/1998/Math/MathML" class="banner">
<h1 class="banner"><a href="#"><span>Advanced GTK Techniques</span></a></h1>
<h2 class="banner"><span>Setting up Gettext</span></h2>
</div>
<div class="links nextlinks">« <a class="nextlinks-prev" href="desktop-file.html" title="Icons and desktop files">Icons and desktop files</a> :: <a class="nextlinks-contents" href="real-life-app-setup.html" title="Setting up a real-life GTK application">Contents</a>
</div>
<div class="page">
<div class="header"><div class="trails"><div class="trail">
<a class="trail" href="index.html" title="Advanced GTK Techniques">Advanced GTK Techniques</a> » <a class="trail" href="real-life-app-setup.html" title="Setting up a real-life GTK application">Setting up a real-life GTK application</a> » </div></div></div>
<div class="body">
<div class="hgroup"><h1 class="title"><span class="title">Setting up <span class=" app">Gettext</span></span></h1></div>
<div class="region">
<div class="contents">
<div class="synopsis"><div class="inner"><div class="region"><div class="contents">
<p class="p">In this tutorial, you will learn:</p>
<div class="list"><div class="inner"><div class="region"><ul class="list">
<li class="list"><p class="p">How to translate your program's source code using <span class=" app">Gettext</span></p></li>
<li class="list"><p class="p">How to translate other files using <span class=" app">Intltool</span></p></li>
</ul></div></div></div>
<p class="p">This tutorial is part of the <span class=" em">Setting up a real-life GTK application</span> series.
If you don't want to follow along with the previous parts, simply copy the <span class=" link"><a href="../app-skeleton3" title="../app-skeleton3"><span class=" file">app-skeleton3</span></a></span> directory from the tutorial's code examples.
Or, you can start from the <span class=" link"><a href="real-life-app-setup.html" title="Setting up a real-life GTK application">beginning</a></span>.</p>
</div></div></div></div>
<p class="p">There is one more piece of infrastructure to add before we start writing real code.
That is allowing the program to be translated into other languages.
You might think that translation is something to be done only after the application is finished, but it's much easier to keep translation in mind while you are writing the application.</p>
<p class="p">Do you have to learn thirty languages to do this?
No.
The way it usually works in an open source project is that you write the program in English (or, strictly speaking, in the "C locale".)
Another tool, <span class=" cmd">gettext</span>, extracts all the words and phrases from the program that will be displayed to users, and puts them in a <span class=" em">translation template</span> or <span class=" file">.pot</span> file.</p>
<p class="p">You then recruit translators to your project (this is the hard part) and they translate some or all of the phrases in the translation template, producing a <span class=" file">.po</span> file.
Generally, you give your translators commit access to your source code repository, so they just commit the <span class=" file">.po</span> files whenever they are done.
The <span class=" cmd">make install</span> process takes care of installing the translations in the proper places in the user's system.</p>
<p class="p">When the program is started, it looks at the value of the <span class=" code">LANG</span> environment variable.
If this contains a language code for a language which the program is available in, then the program will display the translated phrases for that language.
If not, the program will simply be in English.
Also, if the translator did not finish translating the entire translation template, then the program will be in the other language as much as possible, and any untranslated phrases will still be in English.
This allows translation to be an ongoing process, and translators can contribute as much as they have time for.
Also, if you add a new message in a new version of the program, and the translator is on vacation, it won't mean the whole translation is invalidated.</p>
</div>
<div id="" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Using <span class=" cmd">gettext</span></span></h2></div>
<div class="region"><div class="contents">
<p class="p">First, copy the project that we have so far to a new <span class=" file">app-skeleton4</span> directory, and change the version number if you like.
To add <span class=" cmd">gettext</span> to our build system, add the following lines to the "Shopping List" section of <span class=" file">configure.ac</span>:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/configure.ac" title="../app-skeleton4/configure.ac">app-skeleton4/configure.ac</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">AM_GNU_GETTEXT([external])
AM_GNU_GETTEXT_VERSION([0.18.1])</pre></div></div></div>
</div></div>
<p class="p">Also, add <span class=" code">po/Makefile.in</span> to the <span class=" code">AC_CONFIG_FILES</span> call in the "Output" section, and <span class=" code">po</span> to the <span class=" code">SUBDIRS</span> variable in <span class=" file">Makefile.am</span>.
(The <span class=" file">po</span> subdirectory is where the <span class=" cmd">gettext</span> files are placed by default.)</p>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents"><p class="p">It is slightly confusing that we should put a file named <span class=" code">Makefile.in</span> into <span class=" code">AC_CONFIG_FILES</span>.
  Didn't <span class=" cmd">configure</span> transform <span class=" file">Makefile.in</span> into <span class=" file">Makefile</span>?
  In this case, <span class=" cmd">gettext</span> installs a <span class=" file">Makefile.in.in</span> which we transform into <span class=" file">Makefile.in</span>.
  Then, code generated by the <span class=" code">AM_GNU_GETTEXT</span> macro transforms the <span class=" file">Makefile.in</span> into <span class=" file">Makefile</span> automatically.
  One hopes that things won't get any more convoluted in the future, with tools that install a <span class=" file">Makefile.in.in.in.in</span>.</p></div></div></div></div>
<p class="p">To install the <span class=" cmd">gettext</span> files, simply run the bootstrapping command: <span class=" cmd">autoreconf -i</span>.
Then, before running <span class=" cmd">configure</span>, there are a few files we have to add to the <span class=" file">po</span> directory.
The first is called <span class=" file">POTFILES.in</span>.
This is a list of files that contain translatable messages for <span class=" cmd">gettext</span> to extract.
The next file is called <span class=" file">LINGUAS</span>.
This file contains a space-separated list of all available translations.
Create both files and leave them empty for now, we will fill them later.</p>
<p class="p">The last file to create is called <span class=" file">Makevars</span>.
This file contains some customizable variables that get inserted into the <span class=" file">po</span> directory's <span class=" file">Makefile</span>.
After running <span class=" cmd">autoreconf</span>, there should be a template for this file called <span class=" file">Makevars.template</span>.
Copy this to <span class=" file">Makevars</span> and edit it.
It doesn't need much changing; I changed the <span class=" code">COPYRIGHT_HOLDER</span> variable to my name, and the <span class=" code">MSGID_BUGS_ADDRESS</span> to <span class=" code">$(PACKAGE_BUGREPORT)</span>, so that translators report bugs in the messages to the same place that regular bugs should be reported.
(In a large project, you might want to separate these.)</p>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents"><p class="p">Autoconf sets the <span class=" code">PACKAGE_BUGREPORT</span> variable to the bug report address that we specified in the call to <span class=" code">AC_INIT</span> in <span class=" file">configure.ac</span>.</p></div></div></div></div>
<p class="p">Next, we must mark all the user interface strings in <span class=" file">hello-world.c</span> for translation.
First, add at the top of the file:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/src/hello-world.c" title="../app-skeleton4/src/hello-world.c">app-skeleton4/src/hello-world.c</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">#include &lt;glib/gi18n.h&gt;</pre></div></div></div>
</div></div>
<p class="p">This is a special GLib header file where the interface to <span class=" cmd">gettext</span> is defined.
(<span class=" code">i18n</span> stands for "internationalization", because there are eighteen letters between the initial I and the final N.)
In particular, this header defines the <span class=" code">_()</span> macro with which we mark our strings.
(If <span class=" cmd">gettext</span> support is disabled, <span class=" code">_()</span> does nothing; otherwise it is an alias for the <span class=" code">gettext()</span> function.
It is called <span class=" code">_</span> so as to save typing and not to distract the eye while reading the code.)</p>
<p class="p">Then, add the following code to the top of the <span class=" code">main()</span> function, at line 40:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/src/hello-world.c" title="../app-skeleton4/src/hello-world.c">app-skeleton4/src/hello-world.c</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">/* Set up internationalization */
setlocale (LC_ALL, "");
bindtextdomain (PACKAGE, LOCALEDIR);
textdomain (PACKAGE);</pre></div></div></div>
</div></div>
<p class="p">This sets up the program to read the translated message files. Finally, add the following line to the makefile so that the program knows where to find the message files:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/src/Makefile.am" title="../app-skeleton4/src/Makefile.am">app-skeleton4/src/Makefile.am</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">AM_CPPFLAGS = -DLOCALEDIR=\""$(localedir)"\"</pre></div></div></div>
</div></div>
<p class="p">There are four strings that we need to mark for translation:
one in <span class=" code">print_hello()</span>,
one in <span class=" code">on_delete_event()</span>,
the argument of <span class=" code">gtk_window_set_title()</span> in <span class=" code">main()</span>,
and the argument of <span class=" code">gtk_button_new_with_label()</span> in <span class=" code">main()</span>.
Surround these strings with a call to <span class=" code">_()</span>, so that <span class=" code">"Hello World"</span> becomes <span class=" code">_("Hello World")</span>.</p>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents"><p class="p">Note that not <span class=" em">all</span> the strings should be translated!
  For example, the names of the signals in <span class=" code">g_signal_connect()</span> and the icon name in <span class=" code">gtk_window_set_icon_name()</span> should be left as they are.
  They are not displayed to the user; instead, they have an internal meaning to the program.
  If we were to translate the <span class=" code">destroy</span> signal into German, then the program would stop working, since it would try to connect to the <span class=" code">zerstören</span> signal, which of course it has never heard of.</p></div></div></div></div>
<p class="p">Last of all, we need to add our source file with the strings marked for translation to <span class=" file">POTFILES.in</span>, so <span class=" cmd">gettext</span> knows to look there:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/po/POTFILES.in" title="../app-skeleton4/po/POTFILES.in">app-skeleton4/po/POTFILES.in</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">src/hello-world.c</pre></div></div></div>
</div></div>
<p class="p">If we now change to the <span class=" file">po</span> directory and run <span class=" cmd">make update-po</span>, an <span class=" file">app-skeleton.pot</span> should be generated.
This is the template that translators can base their translations on.</p>
</div></div>
</div></div>
<div id="" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Translating the program</span></h2></div>
<div class="region"><div class="contents">
<p class="p">Now, we will translate the program into another language and test it.
If you speak another language than English, why not try translating it into that language?
As an example, I will use Dutch (language code <span class=" code">nl</span>) here.</p>
<p class="p">The first thing to do is to create a <span class=" file">.po</span> file for your chosen language.
Change to the <span class=" file">po</span> directory and type:</p>
<div class="screen"><pre class="contents "><span class=" input">msginit -l nl</span></pre></div>
<p class="p">This will create a file named <span class=" file">nl.po</span>, based on the translation template.
You can edit it with your favorite text editor, although for bigger projects you might want to use a dedicated translation editor such as <span class=" link"><a href="http://www.google.com" title="http://www.google.com">Virtaal</a></span> or <span class=" link"><a href="http://www.google.com" title="http://www.google.com">Poedit</a></span>.
Translate the messages as you see fit, or use my translations:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file">app-skeleton4/po/nl.po</span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">#: src/hello-world.c:11
msgid "Hello World\n"
msgstr "Hallo Wereld\n"

#: src/hello-world.c:27
msgid "delete event occurred\n"
msgstr "delete event heeft plaatsgevonden\n"

#: src/hello-world.c:52
msgid "Hello"
msgstr "Hallo"

#: src/hello-world.c:76
msgid "Hello World"
msgstr "Hallo Wereld"</pre></div></div></div>
</div></div>
<p class="p">After translating, add the language code to the <span class=" file">LINGUAS</span> file:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/po/LINGUAS" title="../app-skeleton4/po/LINGUAS">app-skeleton4/po/LINGUAS</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">nl</pre></div></div></div>
</div></div>
<p class="p">Then change to the <span class=" file">po</span> directory and run <span class=" cmd">make update-po</span> again.
It is important to do this whenever a translator gives you an updated <span class=" file">.po</span> file, otherwise the new translations will not get installed.
Then install the program once again using <span class=" cmd">make install</span>.</p>
<p class="p">You should now be able to run the program in Dutch (or whatever language you chose.)
If your system locale is set to Dutch, then simply running the program should work.
If you have your system in English or a different locale, you can test the translation by running the program with the <span class=" code">LANG</span> environment variable set to <span class=" code">nl</span>.
(Just type <span class=" code">LANG=nl</span> before the program name on the command line.)</p>
</div></div>
</div></div>
<div id="" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Translating non-source code</span></h2></div>
<div class="region"><div class="contents">
<p class="p">The <span class=" cmd">gettext</span> program has one shortcoming:
it only works in program code, where it can call the <span class=" code">gettext()</span> function to fetch its translations.
Data files, such as a GUI definition in XML, or the <span class=" link"><a href="desktop-file.html" title="Icons and desktop files">desktop file</a></span>, don't get translated.
This is why <span class=" cmd">intltool</span> was invented.
It takes translatable strings from these files and adds them to the translation template.
Then, when they have been translated, it merges the strings back into the data files.
We will now add <span class=" cmd">intltool</span> to our program and use it to translate the desktop file.</p>
<p class="p">First of all, <span class=" cmd">intltool</span> has its own bootstrapping program, called <span class=" cmd">intltoolize</span>.
It needs to be run after <span class=" cmd">autoreconf</span>.
Since using <span class=" cmd">intltool</span> means we can't bootstrap the build system simply by using <span class=" cmd">autoreconf -i</span> anymore, we will make a <span class=" link"><a href="" title="autoconf-project#note:bootstrapping">bootstrap script</a></span>.
Create a file in called <span class=" file">autogen.sh</span>, make it executable, and write in it:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/autogen.sh" title="../app-skeleton4/autogen.sh">app-skeleton4/autogen.sh</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">#!/bin/bash

echo "Regenerating autotools files"
autoreconf --force --install || exit 1

echo "Setting up Intltool"
intltoolize --copy --force --automake || exit 1</pre></div></div></div>
</div></div>
<p class="p">We need the <span class=" cmd">--force</span> options because <span class=" cmd">autoreconf</span> and <span class=" cmd">intltoolize</span> overwrite each other's <span class=" file">po/Makefile.in.in</span> files.
Go ahead and run the bootstrap script now.</p>
<p class="p">Then, add to the "Shopping List" section in <span class=" file">configure.ac</span>:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/configure.ac" title="../app-skeleton4/configure.ac">app-skeleton4/configure.ac</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">IT_PROG_INTLTOOL([0.40])</pre></div></div></div>
</div></div>
<p class="p">Below the "Libraries" section, add a new section called "Variables."
To use <span class=" cmd">intltool</span>, we need to define a variable called <span class=" code">GETTEXT_PACKAGE</span> that contains the name of the program as it is known to <span class=" cmd">gettext</span>:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/configure.ac" title="../app-skeleton4/configure.ac">app-skeleton4/configure.ac</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents "># Needed by intltool
GETTEXT_PACKAGE=${PACKAGE_TARNAME}
AC_SUBST([GETTEXT_PACKAGE])</pre></div></div></div>
</div></div>
<p class="p">The call to <span class=" code">AC_SUBST</span> makes sure that any occurrences of <span class=" code">@GETTEXT_PACKAGE@</span> in the makefiles are replaced with the contents of the variable. Now run <span class=" cmd">make</span> again.</p>
<p class="p">Next, we need to tell <span class=" cmd">intltool</span> which data files contain translatable strings.
There is actually a script, <span class=" cmd">intltool-prepare</span> that will automate that for us.
Change to the project root directory and run <span class=" cmd">intltool-prepare</span>.
You will notice that it automatically adds the desktop file to <span class=" file">po/POTFILES.in</span> and it changes the install rule for the desktop file in <span class=" file">Makefile.am</span>.</p>
<p class="p">It also creates a new file, <span class=" file">app-skeleton.desktop.in</span>.
If you are using a source control system for your project, remove the <span class=" file">app-skeleton.desktop</span> from your repository as the script suggests; it is now automatically generated from <span class=" file">app-skeleton.desktop.in</span>, which you should add to your repository.
From now on, when you want to edit the desktop file, edit <span class=" file">app-skeleton.desktop.in</span> instead.</p>
<p class="p">To translate the desktop file, go to the <span class=" file">po/</span> directory and run <span class=" cmd">make update-po</span> once more.
You will see two new untranslated strings added to the <span class=" file">.pot</span> and <span class=" file">.po</span> files.
Translate them yourself, or use my Dutch translation:</p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title"><span class=" file"><a href="../app-skeleton4/po/nl.po" title="../app-skeleton4/po/nl.po">app-skeleton4/po/nl.po</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="code"><pre class="contents ">#: ../app-skeleton.desktop.in.h:1
msgid "A sample application from the Advanced GTK+ Techniques tutorial"
msgstr "Een voorbeeldapplicatie uit de cursus Gevorderde GTK+ Technieken"

#: ../app-skeleton.desktop.in.h:2
msgid "App Skeleton"
msgstr "Skeletapplicatie"</pre></div></div></div>
</div></div>
<p class="p">Then, run <span class=" cmd">make update-po</span> once more, then <span class=" cmd">make</span>.
You can look inside the generated <span class=" file">app-skeleton.desktop</span> file to ascertain that your translations have been merged.
If you now run <span class=" cmd">make install</span>, the translated file will be installed.</p>
<p class="p">With this, all our build infrastructure is in place.
Now we can begin writing some real code.
You are ready to start on the next tutorial, <span class=" link"><a href="real-life-app-writing.html" title="Writing a real-life GTK application">Writing a real-life GTK application</a></span>.</p>
</div></div>
</div></div>
<div class="sect sect-links">
<div class="hgroup"></div>
<div class="contents"><div class="links guidelinks"><div class="inner">
<div class="title"><h2><span class="title">More Information</span></h2></div>
<div class="region"><ul><li class="links">
<a href="real-life-app-setup.html" title="Setting up a real-life GTK application">Setting up a real-life GTK application</a><span class="desc"> — Putting together the build infrastructure for an application</span>
</li></ul></div>
</div></div></div>
</div>
</div>
<div class="clear"></div>
</div>
<div class="footer"><div class="sect about">
<div class="hgroup"><h2>About</h2></div>
<div class="region"><div class="contents">
<div class="copyrights"><div class="copyright">© 2008-2012 Philip Chimento</div></div>
<div class="aboutblurb authors">
<div class="title"><span class="title">Written By</span></div>
<ul class="credits"><li>Philip Chimento</li></ul>
</div>
<div class="aboutblurb maintainers">
<div class="title"><span class="title">Maintained By</span></div>
<ul class="credits"><li>Philip Chimento</li></ul>
</div>
<div class="aboutblurb license">
<div class="title"><span class="title">Creative Commons</span></div>
<div class="contents"><p class="p">This work is licensed under a <span class=" link"><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" title="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a></span>.</p></div>
</div>
</div></div>
</div></div>
</div>
<div class="links nextlinks">« <a class="nextlinks-prev" href="desktop-file.html" title="Icons and desktop files">Icons and desktop files</a> :: <a class="nextlinks-contents" href="real-life-app-setup.html" title="Setting up a real-life GTK application">Contents</a>
</div>
</body>
</html>
